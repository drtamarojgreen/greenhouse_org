# Website Integration Guide: Connecting Wix Velo Apps to greenhousementalhealth.org

This guide outlines the process of integrating backend services developed within the Greenhouse Mental Health IT repository (located at `https://github.com/drtamarojgreen/endpoints`) with the main public-facing website, `https://www.greenhousementalhealth.org/`.

Our backend services are built using Wix Velo, exposing functionalities as web modules (`.jsw` files) that can be securely called from your Wix site's frontend code.

---

## 1. Understanding Wix Velo Backend Services

Backend functions defined in `.jsw` files within the `backend` folder of your Wix project are automatically exposed as web modules. This means they can be imported and called directly from your site's page code, public files, or custom elements.

**Key Principle**: You do not directly load backend `.jsw` files into an iframe. Instead, a Wix page (or custom element) calls the backend function, processes the data, and renders the content. If needed, *that Wix page* can then be embedded into an iframe.

---

## 2. Accessing Backend Services from Your Wix Site's Frontend

To utilize a backend service, you import its functions into your frontend JavaScript code within the Wix Editor.

### Importing Backend Functions

Import the desired function at the top of your frontend code file (e.g., a page's code, a public `.js` file, or a custom element's `.js` file). The path is relative to the `backend` folder in your Wix project structure.

**Example: Importing `getFAQs` from `faqs.jsw`**

```javascript
import { getFAQs } from 'backend/faqs'; // Path: backend/faqs.jsw
```

**Example: Importing `getLatestVideosFromFeed` from `youtubeFeed.jsw`**

```javascript
import { getLatestVideosFromFeed } from 'backend/youtubeFeed'; // Path: backend/youtubeFeed.jsw
```

### Calling Backend Functions

Once imported, these functions can be called like any other asynchronous JavaScript function. They return Promises, so always use `async/await` for clean and readable code.

**Example: Loading and Displaying FAQs on a Wix Page**

This code would go into the Code panel of a Wix page (e.g., a page named "FAQs Display"). Ensure you have appropriate elements on your page (e.g., a Repeater with ID `faqRepeater` and text elements `questionText`, `answerText`, or a simple Text element with ID `faqDisplay`).

```javascript
// Code for your Wix page (e.g., "FAQs Display Page")

import { getFAQs } from 'backend/faqs'; // Import the backend function

$w.onReady(function () {
  loadFAQs(); // Call the function to load FAQs when the page is ready
});

async function loadFAQs() {
  try {
    const faqs = await getFAQs(); // Call the backend function
    
    if (faqs && faqs.length > 0) {
      // Example: Displaying FAQs in a Repeater (assuming you have one with ID 'faqRepeater')
      // Ensure your Repeater has text elements with IDs like 'questionText' and 'answerText'
      $w("#faqRepeater").data = faqs.map(faq => ({
        _id: faq.id, // Repeaters require an _id field
        question: faq.question,
        answer: faq.answer
      }));

      $w("#faqRepeater").onItemReady(($item, itemData, index) => {
        $item("#questionText").text = itemData.question;
        $item("#answerText").text = itemData.answer;
      });

      // If you don't have a Repeater, you could display in a simple text element:
      // $w("#faqDisplay").text = `Q: ${faqs[0].question}\nA: ${faqs[0].answer}`;

    } else {
      $w("#faqDisplay").text = "No FAQs found at this time.";
    }
  } catch (error) {
    console.error("Error fetching FAQs:", error);
    $w("#faqDisplay").text = "Failed to load FAQs. Please check the backend code and site permissions.";
  }
}
```

---

## 3. Embedding Wix Pages in Iframes

If you need to display content generated by a Wix page (which itself calls backend services) within an iframe on another part of your site or an external platform, follow these steps:

1.  **Create the Wix Page:** Design and implement the Wix page (e.g., "MyFAQsPage") that uses the Velo frontend code to fetch and display the desired content. Ensure this page is published.
2.  **Obtain the Page URL:** After publishing, get the live URL of this Wix page (e.g., `https://yourdomain.com/myfaqspage`).
3.  **Add an "Embed a Site" Element:** On the Wix page where you want the iframe to appear, add an "Embed a Site" element from the "Embed & HTML" section in the Wix Editor.
4.  **Configure the Iframe:** In the settings panel for the "Embed a Site" element, set its `Website Address (URL)` to the live URL of your content page (e.g., `https://yourdomain.com/myfaqspage`).

**Conceptual HTML for an Iframe (for reference):**

```html
<!-- This is how an iframe might look in raw HTML, typically configured via Wix Editor -->
<iframe src="https://yourdomain.com/myfaqspage" width="100%" height="600px" frameborder="0" allowfullscreen></iframe>
```

---

## 4. Available Backend Services & Endpoint Documentation

The backend services developed for Greenhouse Mental Health are located in the `apps/wv/backend/` directory of this repository. Their detailed endpoint documentation, including parameters and return types, is available at:

**`https://github.io/drtamarojgreen/endpoints`**

This documentation provides the necessary information for developers to understand and integrate each service effectively.

---

## 5. Key Considerations for Integration

*   **Asynchronous Operations**: All backend calls are asynchronous.
*   **Error Handling**: Always implement robust `try...catch` blocks to handle potential errors from backend calls.
*   **Data Validation**: Ensure data is validated on both the frontend and backend for integrity and security.
*   **Security & Permissions**: Backend functions run in a secure environment. Only expose data and operations that are safe for the frontend to access. For sensitive operations (e.g., data submission), implement proper authentication and authorization checks within your backend functions and Wix site permissions.
*   **Performance**: Optimize frontend rendering and backend queries to ensure a fast and responsive user experience.
