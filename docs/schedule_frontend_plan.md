# Schedule App Frontend Integration Plan

## 1. Current State & Problem Statement

The scheduling application's frontend components (HTML, CSS, JavaScript) are currently located in `apps/frontend/schedule/`. The goal is to integrate this application into the main website (`https://greenhousementalhealth.org/schedule/`) by loading its assets from GitHub Pages (`https://drtamarojgreen.github.io/greenhouse_org/`).

**Problem:** Currently, "nothing is displaying and nothing is connected" on the main website. This is because the frontend assets are not being correctly loaded and integrated into the main website's DOM.

## 2. Key Components

*   **`index.html`**: (Conceptual, content programmatically generated) - Serves as the patient-facing form for requesting appointments.
*   **`dashboard.html`**: (Conceptual, content programmatically generated) - Serves as the admin-facing weekly schedule page for staff to work on schedule conflict resolution. Now includes example service data and visual conflict indicators.
*   **`admin.html`**: (Conceptual, content programmatically generated) - Serves as the admin-facing page for staff to administer individual schedule appointment information.
*   **`app.js`**: (Located at `docs/js/app.js`) - Contains the core JavaScript logic for the scheduling application. This includes:
    *   Appointment management (add, edit, delete, display).
    *   Interaction with the Velo backend via direct function calls.
    *   DOM manipulation for rendering the UI.
    *   Conflict detection and modal display.
*   **`dashboard.js`**: (Located at `docs/js/dashboard.js`) - Contains the JavaScript logic for programmatically building the Administrator Dashboard UI.
*   **`admin.js`**: (Located at `docs/js/admin.js`) - Contains the JavaScript logic for programmatically building the Individual Appointment Administration UI.
*   **`schedule.css`**: (Located at `docs/css/schedule.css`) - Contains the styling for the scheduling application, now significantly enhanced for a modern and sharp look, including styles for service colors and conflict representation.
*   **`scheduler.js`**: (Located at `docs/js/scheduler.js`) - This is the primary script loaded by `greenhouse.js` on the `/schedule/` page. Its responsibility is to fetch and inject the necessary HTML, CSS, and JavaScript (from `app.js`, `dashboard.js`, `admin.js`) into the main website's DOM.
*   **`effects.js`**: (Located at `docs/js/effects.js`) - Contains JavaScript for dynamic effects on the header, loaded on all pages by `greenhouse.js`.
*   **`greenhouse.js`**: (Located at `docs/js/greenhouse.js`) - The main entry point for all JavaScript on the site, responsible for conditionally loading `effects.js` and `scheduler.js`.

## 3. Implementation Strategy

The integration will follow these phases, with a focus on modularity and conditional loading:

### Phase 1: Asset Preparation & Organization (Completed)

1.  **Centralized JavaScript:** All JavaScript files (`greenhouse.js`, `effects.js`, `scheduler.js`, `app.js`, `dashboard.js`, `admin.js`) are now located in the `docs/js/` directory.
2.  **Centralized CSS:** The main CSS file (`schedule.css`) is now located in the `docs/css/` directory.
3.  **Conceptual HTML Files:** `index.html`, `dashboard.html`, and `admin.html` are now conceptual, as their content is programmatically generated by JavaScript.

### Phase 2: Dynamic Script Loading with `greenhouse.js` (New Entry Point)

1.  **Create `greenhouse.js`**: This new file is the single entry point for all JavaScript on the site. It is loaded on every page.
    *   **Location**: `docs/js/greenhouse.js`
    *   **Responsibility**:
        *   Loads `effects.js` on all pages (for header effects).
        *   Checks the current URL. If it matches the `/schedule/` path, it then loads `scheduler.js`.
2.  **Refactor `scheduler.js`**:
    *   Removed its self-executing IIFE.
    *   Exposes `window.loadScheduleApp` as a global function, which `greenhouse.js` calls.
    *   `loadScheduleApp` is responsible for fetching `schedule.css`, `app.js`, and the appropriate UI-building script (`dashboard.js` or `admin.js`) based on URL parameters.
3.  **Programmatic UI Generation**:
    *   `scheduler.js` now calls `buildPatientFormUI()` (for the patient form), `buildDashboardUI()` (from `dashboard.js`), or `buildAdminUI()` (from `admin.js`) to programmatically construct the DOM.
    *   `dashboard.js` and `admin.js` are dedicated to building their respective UIs.

### Phase 3: Deployment & Integration

1.  **Deploy to GitHub Pages**: Ensure all relevant files (`greenhouse.js`, `effects.js`, `scheduler.js`, `app.js`, `dashboard.js`, `admin.js`, `schedule.css`) are committed and pushed to the `greenhouse_org` GitHub repository, making them accessible via GitHub Pages.
2.  **Main Website Integration**: On the main website (`https://greenhousementalhealth.org/`), add a single `<script>` tag in the appropriate location (e.g., within the `<body>` or at the end of the `<body>`) that points to the `greenhouse.js` file on GitHub Pages:
    ```html
    <script src="https://drtamarojgreen.github.io/greenhouse_org/js/greenhouse.js"></script>
    ```

## 4. Critical Considerations & Next Steps

*   **API Endpoints for `app.js`**: The `app.js` now directly calls Velo backend functions (e.g., `scheduling.getAppointments()`, `services.getServices()`). This resolves the previous issue of relative API paths.
*   **DOM Element Specificity**: The provided CSS selectors are very specific. Ensure that the target DOM elements on the main website are stable and consistently available when `scheduler.js` attempts to inject content.
*   **Error Handling**: All JavaScript files (`greenhouse.js`, `scheduler.js`, `app.js`, `dashboard.js`, `admin.js`) should include robust error handling for `fetch` operations and Velo backend calls.
*   **Loading Indicators**: Consider adding loading indicators to the main website while the schedule app's content is being fetched and injected.
*   **Programmatic DOM Generation for Admin Views (Pending)**: While `scheduler.js` is now set up to dynamically load `dashboard.js` and `admin.js`, the actual programmatic UI generation within `dashboard.js` and `admin.js` is still in its early stages and requires further development.

## 5. Two-Component Architecture

The scheduling application is designed to support two distinct user interfaces and functionalities:

1.  **User-Facing Component (Appointment Request)**:
    *   **Purpose**: Allows general users to view available services and request new appointments.
    *   **UI Generation**: Programmatically built by `scheduler.js` using `buildPatientFormUI()`.
    *   **Integration**: Loaded by `greenhouse.js` (via `scheduler.js`) when the URL indicates the patient view.

2.  **Admin-Facing Components (Conflict Resolution & Management)**:
    *   **Purpose**: Provides administrators with tools to view, manage, and resolve scheduling conflicts, and manage services and appointments directly.
    *   **UI Generation**:
        *   **Dashboard**: Programmatically built by `dashboard.js` (loaded by `scheduler.js`).
        *   **Individual Admin**: Programmatically built by `admin.js` (loaded by `scheduler.js`).
    *   **Integration Considerations**:
        *   **Loading Mechanism**: `greenhouse.js` (via `scheduler.js`) will determine which component to load based on URL parameters (e.g., `mainwebsite.com/schedule?view=dashboard` or `mainwebsite.com/schedule?view=admin`).
        *   **Asset Management**: JavaScript files (`dashboard.js`, `admin.js`) are now separate and located in `docs/js/` for modularity.
        *   **Backend Interaction**: These components will interact with administrator-specific backend APIs for conflict resolution and management.

This two-component architecture is supported by the new modular script loading managed by `greenhouse.js`.